#!/usr/bin/python
from selenium import webdriver
import threading
import os
import time
import random
import sys

def screen(url, output):
    profile = webdriver.FirefoxProfile()
    profile.accept_untrusted_certs = True
    browser = webdriver.Firefox(firefox_profile=profile, timeout=10)
    time.sleep(1)
    browser.get(url)
    browser.save_screenshot(output)
    browser.close()

def parse(hfile, size, lock):
    while(hfile.tell() < size):
        line = hfile.readline().strip()
        if line not in "":
            (host, port) = line.split(":")
            if port in '443':
                url = "https://" + host + ":" + port
            else:
                url = "http://" + host + ":" + port
            output = host + ".P" + port + ".png"
        screen(url, output)

def filesize(hfile):
    hfile.seek(0, os.SEEK_END)
    size = hfile.tell()
    hfile.seek(0)
    return size

if __name__=="__main__":
    hfile = open(sys.argv[1], "r")
    size = filesize(hfile)
    lock = threading.Lock()

    for i in xrange(0, 5):
        threading.Thread(target=parse, args=(hfile, size, lock)).start()
